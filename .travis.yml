language: python
sudo: false
dist: xenial
cache: pip

env:
  global:
    - PYTHONFAULTHANDLER=x
    - SKIP_LATEX_BUILD=1

matrix:
  include:
    - python: '3.5'
      env:
        - TOXENV=du12
    - python: '3.6'
      env:
        - TOXENV=du13
    - python: '3.7'
      env:
        - TOXENV=py37
        - PYTEST_ADDOPTS="--cov ./ --cov-append --cov-config setup.cfg"
    - python: 'nightly'
      env: TOXENV=py38
    - python: '3.6'
      env: TOXENV=docs
      script: tox -- -v
    - python: '3.6'
      env: TOXENV=mypy
    - python: '3.6'
      env: TOXENV=flake8

    - language: node_js
      node_js:
        - 10.7
      install:
        - "sudo apt-get install graphviz"
        - npm install
      script: npm test
      services: xvfb

install:
  - "sudo apt-get install graphviz"
  - pip install -U tox codecov

script: tox -- -v -n 2

after_success:
  - if [[ -e .coverage ]]; then codecov -e $TOXENV; fi
